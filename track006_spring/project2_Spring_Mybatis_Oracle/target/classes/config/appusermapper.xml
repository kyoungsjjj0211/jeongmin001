<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.thejoa703.dao.AppUserMapper">

  <insert  id="insertAuth"    parameterType="AuthDto">
  	insert into  authorities  (email, auth)  values (#{email} , #{auth})
  </insert>   
  <insert id="insert" parameterType="AppUser">
  insert into appuser(APP_USER_ID, EMAIL, PASSWORD, MBTI_TYPE_ID, UFILE, MOBILE, NICKNAME) 
  values (appuser_seq.nextval ,#{email},#{password},#{mbtiTypeId},#{ufile, jdbcType=VARCHAR},#{mobile},#{nickname})
  </insert>
  <update id="update" parameterType="AppUser">
  update appuser  set  MBTI_TYPE_ID=#{mbtiTypeId}, UFILE=#{ufile, jdbcType=VARCHAR}, MOBILE=#{mobile}, NICKNAME=#{nickname}  where app_user_id=#{appUserId}
  </update> 
  
  <delete id="delete" parameterType="AppUser">
  delete from appuser  where app_user_id=#{appUserId}  
  </delete>
  
  <resultMap type="AppUser" id="appUserMap">
  	<result		property="appUserId" column="APP_USER_ID"	/>
  	<result		property="email" column="EMAIL"	/>
  	<result		property="password" column="PASSWORD"	/>
  	<result		property="mbtiTypeId" column="MBTI_TYPE_ID"	/>
  	<result		property="createdAt" column="CREATED_AT"	/>
  	<result		property="ufile" column="UFILE"	/>
  	<result		property="mobile" column="MOBILE"	/>
  	<result		property="nickname" column="NICKNAME"	/>
  </resultMap>
  
  <resultMap type="AuthDto" id="authMap">
  	<result		property="email" column="EMAIL"	/>
  	<result		property="auth" column="AUTH"	/>
  </resultMap>
  
  <resultMap type="AppUserAuthDto" id="appUserAuthMap">
  	<result			property="email" 	column="EMAIL"	/>
  	<result			property="password" column="PASSWORD"	/>
  	<collection		property="authList" 	resultMap="authMap"	/>
  </resultMap>
  
  <select resultMap="appUserAuthMap" id="readAuth" 		 parameterType="AppUser">
  select   u.email, password, auth 
	 from appuser u 	left join 	authorities a on  u.email = a.email
	 where u.email = #{email}
	</select>
  <select resultMap="appUserMap" 		 id="select" 		 parameterType="AppUser">
  select * from appuser where email=#{email}
  </select>
    
  <select resultMap="appUserMap" 		 id="selectPassword" parameterType="AppUser"> 
   select password from appuser where email=#{email}
   </select>
  
</mapper>


<!-- 
- create (회원가입) 					 : insert into appuser(APP_USER_ID, EMAIL, PASSWORD, MBTI_TYPE_ID,UFILE, MOBILE, NICKNAME) values (appuser_seq.nextval ,'1@1','1', 1, '1.png' , '1', 'na');
- read   (로그인, 아이디찾기-해당이메일로, 비밀번호 찾기-해당이메일로) : 
 * 해당 이메일로 email, password, 권한들 가져오기 : 
	 select   u.email, password, auth 
	 from appuser u left join authorities a on  u.email = a.email
	 where u.email = '1@1'
 
 * 해당 이메일로 정보가져오기 :
  select * from appuser where email='1@1'  
 * 해당 이메일로 비밀번호찾기 :
  select password from appuser where email='1@1'
  
- update (정보수정) 해당 id의 유저 업데이트 : 
update appuser  set  MBTI_TYPE_ID=2, UFILE='2.png' , MOBILE='1', NICKNAME='1' where app_user_id=1;

- delete (정보삭제) 해당 id의 유저 삭제    :
 delete from appuser  where app_user_id=1;  
 -->